{% extends "base.html" %}

{% block title %}Search - Typo Payments{% endblock %}

{% block content %}
<div class="section">
    <h1>üîç Search Payments</h1>
    <p>Search through your payment history</p>

    <div class="search-box">
        <form method="GET" action="{{ url_for('search') }}">
            <div class="form-group">
                <input type="text" name="q" placeholder="Search by recipient or description..." class="search-input"
                    value="{{ query }}">
                <button type="submit" class="btn btn-primary">Search</button>
            </div>
        </form>
    </div>

    {% if query %}
    <div class="search-results">
        <h3>Search results for: {{ query|safe }}</h3>
        <p class="result-count">Found {{ results|length }} result(s)</p>
    </div>

    {% if error %}
    <div class="card" style="border-left: 4px solid #e74c3c;">
        <h3 style="color: #e74c3c;">‚ö†Ô∏è Error</h3>
        <pre style="background: #f8f9fa; padding: 15px; border-radius: 4px; overflow-x: auto;">{{ error }}</pre>
        <p style="color: #666; margin-top: 10px;">
            <em>Note: Error messages are displayed for demonstration purposes.</em>
        </p>
    </div>
    {% endif %}

    {% if results %}
    <table class="data-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>User</th>
                <th>Recipient</th>
                <th>Amount</th>
                <th>Description</th>
                <th>Status</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody>
            {% for payment in results %}
            <tr>
                <td>#{{ payment.id }}</td>
                <td>{{ payment.user_name }}</td>
                <td>{{ payment.recipient }}</td>
                <td>${{ "%.2f"|format(payment.amount) }}</td>
                <td>{{ payment.description or 'N/A' }}</td>
                <td><span class="badge badge-{{ payment.status }}">{{ payment.status }}</span></td>
                <td>{{ payment.created_at }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="empty-state">No payments found matching your search.</p>
    {% endif %}

    <!-- Debug Toggle Button -->
    <button onclick="toggleDebug()" class="btn btn-secondary" style="margin-top: 20px;">
        üêõ View SQL Query
    </button>

    <!-- SQL Debug Box -->
    <div id="sql-debug-box"
        style="display: none; margin: 20px 0; padding: 15px; background: #f8f9fa; border: 2px solid #007bff; border-radius: 5px;">
        <h4 style="margin-top: 0; color: #007bff;">üîç What's Happening - SQL Query Execution</h4>
        <div
            style="background: #fff; padding: 15px; border-radius: 3px; font-family: 'Courier New', monospace; font-size: 14px; overflow-x: auto;">
            <strong>Executed SQL:</strong>
            <pre
                style="margin: 10px 0; padding: 10px; background: #f1f3f5; border-left: 4px solid #007bff;">{{ sql_query }}</pre>
        </div>
    </div>

    <script>
        function toggleDebug() {
            var debugBox = document.getElementById('sql-debug-box');
            if (debugBox.style.display === 'none') {
                debugBox.style.display = 'block';
            } else {
                debugBox.style.display = 'none';
            }
        }
    </script>

    {% endif %}
</div>


{% endblock %}